/*! Store Map - v0.1.1
 * http://wordpress.org/plugins
 * Copyright (c) 2016; * Licensed GPLv2+ */
function Green_Tiger_Store_Liste_Vue(){var a="store_map_liste";this.addStore=function(b,c){var d='<p class="distance"></p>';"undefined"!=typeof b.distance&&(d='<p class="distance">'+b.distance.distanceAsTexte+"</p>");var e='<div class="titreStore"><h3>'+b.titre+"</h3>"+d+"</div>";e+='<div class="description">'+b.descriptionListe+"</div>";var f={"class":"store_map_description",id:"store-"+b.id,html:e,click:c(b)};jQuery("<div/>",f).appendTo("#"+a)},this.removeContent=function(){jQuery("#"+a).html("")},this.setSelectedStore=function(a){jQuery(".store_map_description").removeClass("activeStore"),jQuery("#store-"+a.id).addClass("activeStore")},this.putSelectedStoreOnTop=function(){var a=jQuery(".activeStore"),b=jQuery("#store_map_liste"),c=a.offset().top,d=b.offset().top,e=-1*(d-c);b.scrollTop(b.scrollTop()+e)},this.scrollToTop=function(){var a=jQuery("#store_map_liste");a.scrollTop(0)},this.getSelectedDiv=function(){return jQuery(".activeStore")},this.getDescriptionListSelector=function(){return jQuery("#store_map_liste")}}function Green_Tiger_Search_Vue(){var a=jQuery("#store_map_search_input"),b=jQuery("#store_map_search_button"),c=jQuery("#store_map_my_position_button"),d=[],e=[];this.addSearchListner=function(a){d.push(a)},this.addMyPositionListner=function(a){e.push(a)},b.click(function(){for(var b in d)d[b](a.val())}),c.click(function(){for(var a in e)e[a]()})}function Green_Tiger_Store_Controleur(a,b,c,d){function e(){d.sortByAlphabeticalOrder();for(var e in d.stores){var h=d.stores[e];h.markUp=a.addMarkUp(h.coordonate,"",h.descriptionMarker,i(h)),b.addStore(h,j)}c.addSearchListner(g),c.addMyPositionListner(f)}function f(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){var b=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);h(b)},function(){alert("You didn't allow position retrieval")}):alert("GeoLocation not supported by browser.")}function g(b){a.getCoordonateFromAdress(b,h)}function h(c){function e(c){var e=d.getProxyStore();e.push(c),a.fitBounds(e),b.removeContent();for(var f in d.stores)b.addStore(d.stores[f],j);b.scrollToTop()}var f=new Green_Tiger_Store_Distance_Updater(c,d);f.update(function(){d.sortByDistance(),e(c)})}function i(a){return function(){b.setSelectedStore(a),b.putSelectedStoreOnTop(a),k(a)}}function j(c){return function(){b.setSelectedStore(c),a.setVueOnMarkUp(c.markUp,9),k(c)}}function k(a){var c=b.getSelectedDiv(),d=b.getDescriptionListSelector();d.trigger("store_map_select_event",[a,c])}e()}function Green_Tiger_Store_Liste_Model(){function a(){for(var a in store_map_data){var c=store_map_data[a];b.stores.push(new Green_Tiger_Store_Model(c.adresse,c.lat,c.lng,c.id,c.titre,c.theDescription))}}var b=this;this.stores=[],a(),this.getStoreAsArrayOf25=function(){for(var a=[],c=0;c<this.stores.length;c+=25)a.push(b.stores.slice(c,c+25));return a},this.getLatLngAsArrayOf25=function(){var a=[];for(var c in b.stores){var d=b.stores[c];a.push(d.coordonate)}var e=[];for(c=0;c<a.length;c+=25)e.push(a.slice(c,c+25));return e},this.setStoreDistance=function(a,c){for(var d in b.stores){var e=b.stores[d];if(e.id===a)return void(e.distance=c)}},this.sortByAlphabeticalOrder=function(){b.stores.sort(function(a,b){return a.titre>b.titre?1:a.titre<b.titre?-1:0})},this.sortByDistance=function(){b.stores.sort(function(a,b){return a.distance.distance>b.distance.distance?1:a.distance.distance<b.distance.distance?-1:0})},this.getProxyStore=function(){for(var a=[],c=0,d=3;d>c&&c<b.stores.length;)a.push(b.stores[c].coordonate),c++;return a}}function Green_Tiger_Store_Model(a,b,c,d,e,f,g){this.titre=e||"Titre inconnu",this.adresse=a||"Adresse inconnu",this.coordonate=new google.maps.LatLng(b,c),this.id=d,this.descriptionListe=f||"Description inconnu",this.descriptionMarker=g||"<h5>"+e+"</h5>"+f}function Green_Tiger_Store_Distance_Updater(a,b){function c(c,e,f){function g(a,d){var e=a.rows[0].elements;for(var g in e){var h=e[g],i={};h.status===google.maps.DistanceMatrixStatus.OK?(i.distanceAsTexte=h.distance.text,i.distance=h.distance.value):(i.distanceAsTexte="",i.distance=Number.MAX_VALUE),b.setStoreDistance(c[g].id,i)}f()}d.getDistanceMatrix({origins:[a],destinations:e,travelMode:google.maps.TravelMode.DRIVING,unitSystem:google.maps.UnitSystem.METRIC},g)}var d=new google.maps.DistanceMatrixService;this.update=function(a){function d(){h++,h===e.length&&a()}for(var e=b.getStoreAsArrayOf25(),f=b.getLatLngAsArrayOf25(),g=0;g<e.length;g++)c(e[g],f[g],d);var h=0}}function Store_Map_Google_Map_Vue(a){function b(a){google.maps.event.addListener(a,"domready",function(){a.setZIndex(d++)})}var c=this,d=1,e=new google.maps.LatLngBounds,f=[],g={zoom:9,center:new google.maps.LatLng(46.34,-72.54),scrollwheel:!1,styles:[{featureType:"all",stylers:[{saturation:-50}]}]};this.map=new google.maps.Map(document.getElementById(a),g),this.openInfoWindow=[],this.centerMapByAdress=function(a){c.getCoordonateFromAdress(a,function(a){c.centerMapByCoordonate(a)})},this.clearAllMarkers=function(){for(var a in f)f[a].setMap(null);f=[]},this.centerMapByCoordonate=function(a,b){"undefined"!==b&&c.map.setZoom(b),c.map.setCenter(a)},this.setVueOnMarkUp=function(a,b){c.map.panTo(a.getPosition()),"undefined"!=typeof b&&c.map.setZoom(b)},this.addMarkUp=function(a,d,g,h){""===d&&"undefined"!=typeof store_map_options.marker_icone_url&&(d=store_map_options.marker_icone_url);var i=new google.maps.Marker({position:a,map:c.map,icon:d});if(i.setMap(c.map),"undefined"!=typeof g){var j=new google.maps.InfoWindow({content:g});i.infowindow=j,i.addListener("click",function(){j.open(c.map,i),h()}),b(j)}return e.extend(a),c.map.fitBounds(e),f.push(i),i},this.addMarkUpByAdresse=function(a){c.getCoordonateFromAdress(a,function(a){c.addMarkUp(a),c.centerMapByCoordonate(a,13)})},this.addMarkUpByCoordonate=function(a,b){var d=new google.maps.LatLng(a,b);console.log(a+" + "+b),c.addMarkUp(d),c.centerMapByCoordonate(d,13)},this.fitBounds=function(a){var b=new google.maps.LatLngBounds;for(var d in a)b.extend(a[d]);c.map.fitBounds(b)},this.getCoordonateFromAdress=function(a,b){var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){if(c===google.maps.GeocoderStatus.OK){var d=a[0].geometry.location;b(d)}else alert("Geocode was not successful for the following reason: "+c)})}}jQuery(function(a){a(window).load(function(){var a=new Green_Tiger_Store_Liste_Model,b=new Store_Map_Google_Map_Vue("store_map_map"),c=new Green_Tiger_Store_Liste_Vue,d=new Green_Tiger_Search_Vue;new Green_Tiger_Store_Controleur(b,c,d,a)})}),jQuery(function(a){function b(){a("#store_map_container").width()<e&&f.hasClass("store_map_row")?(f.removeClass("store_map_row"),f.addClass("store_map_column")):a("#store_map_container").width()>=e&&f.hasClass("store_map_column")&&(f.removeClass("store_map_column"),f.addClass("store_map_row")),console.log(a("#store_map_container").width()+"   "+f.hasClass("store_map_row"))}var c=a("#store_map_liste"),d=a("#store_map_map"),e=parseInt(c.css("min-width"))+parseInt(d.css("min-width")),f=a("#store_map_display");a(window).load(function(){b(),a(window).resize(b)})});